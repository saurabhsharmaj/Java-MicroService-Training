apiVersion: v1
kind: Namespace
metadata:
  name: observability
---
#prometheus-config.yml

apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: observability
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s

    scrape_configs:
      - job_name: 'spring-boot-app'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['host.docker.internal:30506']  # If app is on host, and Prometheus in Docker
            labels:
              application: 'api-tutorial'

---
#loki-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-config
  namespace: observability
data:
  loki.yaml: |
    auth_enabled: false
    server:
      http_listen_port: 3100
    common:
      instance_addr: 0.0.0.0
      path_prefix: /loki
      storage:
        filesystem:
          chunks_directory: /loki/chunks
          rules_directory: /loki/rules
      replication_factor: 1
      ring:
        kvstore:
          store: inmemory

    schema_config:
      configs:
        - from: 2020-10-24
          store: tsdb
          object_store: filesystem
          schema: v13
          index:
            prefix: index_
            period: 24h

    ruler:
      alertmanager_url: http://host.docker.internal:9093

    # By default, Loki will send anonymous, but uniquely-identifiable usage and configuration
    # analytics to Grafana Labs. These statistics are sent to https://stats.grafana.org/
    #
    # Statistics help us better understand how Loki is used, and they show us performance
    # levels for most users. This helps us prioritize features and documentation.
    # For more information on what's sent, look at
    # https://github.com/grafana/loki/blob/main/pkg/usagestats/stats.go
    # Refer to the buildReport method to see what goes into a report.
    #
    # If you would like to disable reporting, uncomment the following lines:
    #analytics:
    #  reporting_enabled: false

---
#Tempo-config.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: tempo-config
  namespace: observability
data:
  tempo.yaml: |
    stream_over_http_enabled: true
    server:
      http_listen_port: 3200
      log_level: info


    cache:
      background:
        writeback_goroutines: 5
      caches:
      - roles:
        - frontend-search  
        memcached: 
          addresses: dns+memcached:11211

    query_frontend:
      search:
        duration_slo: 5s
        throughput_bytes_slo: 1.073741824e+09
        metadata_slo:
            duration_slo: 5s
            throughput_bytes_slo: 1.073741824e+09
      trace_by_id:
        duration_slo: 100ms
      metrics:
        max_duration: 200h                # maximum duration of a metrics query, increase for local setups
        query_backend_after: 5m
        duration_slo: 5s
        throughput_bytes_slo: 1.073741824e+09

    distributor:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: "0.0.0.0:4317"
            http:
              endpoint: "0.0.0.0:4318"

    ingester:
      max_block_duration: 5m               # cut the headblock when this much time passes. this is being set for demo purposes and should probably be left alone normally

    compactor:
      compaction:
        block_retention: 720h                # overall Tempo trace retention. set for demo purposes

    metrics_generator:
      registry:
        external_labels:
          source: tempo
          cluster: docker-compose
      storage:
        path: /var/tempo/generator/wal
        remote_write:
          - url: http://host.docker.internal:9090/api/v1/write
            send_exemplars: true
      traces_storage:
        path: /var/tempo/generator/traces
      processor:
        local_blocks:
          filter_server_spans: false
          flush_to_storage: true

    storage:
      trace:
        backend: local                     # backend configuration to use
        wal:
          path: /var/tempo/wal             # where to store the wal locally
        local:
          path: /var/tempo/blocks

    overrides:
      defaults:
        metrics_generator:
          processors: [service-graphs, span-metrics, local-blocks] # enables metrics generator
          generate_native_histograms: both # enables native histograms for all traces

---
#grafana-provisioning.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-provisioning
  namespace: observability
data:
  datasources.yaml: |
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://host.docker.internal:9090
        isDefault: true
        uid: DS_PROMETHEUS
      - name: Loki
        type: loki
        access: proxy
        url: http://host.docker.internal:3100
        jsonData:
          tracesToLogs:
            datasourceUid: 'loki'  
      - name: Tempo
        type: tempo
        access: proxy
        url: http://host.docker.internal:3200
        jsonData:
          tracesToLogs:
            datasourceUid: 'loki'
  dashboards.yaml: |
    apiVersion: 1
    providers:
      - name: 'default'
        folder: ''
        type: file
        options:
          path: /etc/grafana/provisioning/dashboards


---
#Deployments and Services Prometheus
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus
  namespace: observability
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      labels:
        app: prometheus
    spec:
      containers:
        - name: prometheus
          image: prom/prometheus
          ports:
            - containerPort: 9090
          volumeMounts:
            - name: config
              mountPath: /etc/prometheus/prometheus.yml
              subPath: prometheus.yml
      volumes:
        - name: config
          configMap:
            name: prometheus-config
---
apiVersion: v1
kind: Service
metadata:
  name: prometheus
  namespace: observability
spec:
  selector:
    app: prometheus
  ports:
    - port: 9090
      targetPort: 9090
---
#Deployments and Services Loki
apiVersion: apps/v1
kind: Deployment
metadata:
  name: loki
  namespace: observability
spec:
  replicas: 1
  selector:
    matchLabels:
      app: loki
  template:
    metadata:
      labels:
        app: loki
    spec:
      containers:
        - name: loki
          image: grafana/loki:latest
          args: ["-config.file=/etc/loki/loki.yaml"]
          ports:
            - containerPort: 3100
          volumeMounts:
            - name: config
              mountPath: /etc/loki/loki.yaml
              subPath: loki.yaml
      volumes:
        - name: config
          configMap:
            name: loki-config
---
apiVersion: v1
kind: Service
metadata:
  name: loki
  namespace: observability
spec:
  selector:
    app: loki
  ports:
    - port: 3100
      targetPort: 3100

---
#Deployments and Services Tempo
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo
  namespace: observability
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tempo
  template:
    metadata:
      labels:
        app: tempo
    spec:
      containers:
        - name: tempo
          image: grafana/tempo:latest
          args: ["-config.file=/etc/tempo.yaml"]
          ports:
            - containerPort: 4317
            - containerPort: 3200
          volumeMounts:
            - name: config
              mountPath: /etc/tempo.yaml
              subPath: tempo.yaml
      volumes:
        - name: config
          configMap:
            name: tempo-config
---
apiVersion: v1
kind: Service
metadata:
  name: tempo
  namespace: observability
spec:
  selector:
    app: tempo
  ports:
    - port: 4317
      targetPort: 4317
    - port: 3200
      targetPort: 3200
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  namespace: observability
data:
  datasources.yaml: |
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus:9090
        isDefault: true

      - name: Loki
        type: loki
        access: proxy
        url: http://loki:3100

      - name: Tempo
        type: tempo
        access: proxy
        url: http://tempo:3200
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: observability
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
      - name: default
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-json
  namespace: observability
data:
  my-dashboard.json: |
    {
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "datasource",
            "uid": "grafana"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "limit": 100,
          "name": "Annotations & Alerts",
          "showIn": 0,
          "type": "dashboard"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "DS_PROMETHEUS"
          },
          "enable": true,
          "expr": "resets(process_uptime_seconds{application=\"$application\", instance=\"$instance\"}[1m]) > 0",
          "hide": false,
          "iconColor": "rgba(255, 96, 96, 1)",
          "name": "Restart Detection",
          "showIn": 0,
          "step": "1m",
          "tagKeys": "restart-tag",
          "textFormat": "uptime reset",
          "titleFormat": "Restart"
        }
      ]
    },
    "description": "Dashboard for Micrometer instrumented applications (Java, Spring Boot, Micronaut)",
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 1,
    "id": 1,
    "links": [],
    "panels": [
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "id": 151,
        "panels": [],
        "title": "Api-Tutorials",
        "type": "row"
      },
      {
        "datasource": {
          "type": "tempo",
          "uid": "P214B5B846CF3925F"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 1
        },
        "id": 150,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "tempo",
              "uid": "P214B5B846CF3925F"
            },
            "filters": [
              {
                "id": "4a9a9a07",
                "operator": "=",
                "scope": "span"
              },
              {
                "id": "service-name",
                "operator": "=",
                "scope": "resource",
                "tag": "service.name",
                "value": [
                  "api-tutorial"
                ],
                "valueType": "string"
              }
            ],
            "limit": 20,
            "metricsQueryType": "range",
            "queryType": "traceqlSearch",
            "refId": "A",
            "tableType": "traces"
          }
        ],
        "title": "Api-Tutorial Traces",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "loki",
          "uid": "P8E80F9AEF21F6940"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 1
        },
        "id": 152,
        "options": {
          "dedupStrategy": "none",
          "enableInfiniteScrolling": true,
          "enableLogDetails": true,
          "prettifyLogMessage": false,
          "showCommonLabels": false,
          "showLabels": false,
          "showTime": false,
          "sortOrder": "Descending",
          "wrapLogMessage": false
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "loki",
              "uid": "P8E80F9AEF21F6940"
            },
            "direction": "backward",
            "editorMode": "builder",
            "expr": "{service_name=\"kubernetes-pods\"} |= ``",
            "queryType": "range",
            "refId": "A"
          }
        ],
        "title": "Logs",
        "type": "logs"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 9
        },
        "id": 139,
        "panels": [],
        "title": "Quick Facts",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "decimals": 1,
            "mappings": [
              {
                "options": {
                  "match": "null",
                  "result": {
                    "text": "N/A"
                  }
                },
                "type": "special"
              }
            ],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "s"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 0,
          "y": 10
        },
        "id": 63,
        "maxDataPoints": 100,
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "justifyMode": "auto",
          "orientation": "horizontal",
          "percentChangeColorMode": "standard",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "editorMode": "code",
            "expr": "process_uptime_seconds{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "",
            "metric": "",
            "range": true,
            "refId": "A",
            "step": 14400
          }
        ],
        "title": "Uptime",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [
              {
                "options": {
                  "match": "null",
                  "result": {
                    "text": "N/A"
                  }
                },
                "type": "special"
              }
            ],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "dateTimeAsIso"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 6,
          "y": 10
        },
        "id": 92,
        "maxDataPoints": 100,
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "justifyMode": "auto",
          "orientation": "horizontal",
          "percentChangeColorMode": "standard",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_start_time_seconds{application=\"$application\", instance=\"$instance\"}*1000",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "",
            "metric": "",
            "refId": "A",
            "step": 14400
          }
        ],
        "title": "Start time",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "decimals": 2,
            "mappings": [
              {
                "options": {
                  "match": "null",
                  "result": {
                    "text": "N/A"
                  }
                },
                "type": "special"
              }
            ],
            "max": 100,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "rgba(50, 172, 45, 0.97)"
                },
                {
                  "color": "rgba(237, 129, 40, 0.89)",
                  "value": 70
                },
                {
                  "color": "rgba(245, 54, 54, 0.9)",
                  "value": 90
                }
              ]
            },
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 12,
          "y": 10
        },
        "id": 65,
        "maxDataPoints": 100,
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "justifyMode": "auto",
          "orientation": "horizontal",
          "percentChangeColorMode": "standard",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"})*100/sum(jvm_memory_max_bytes{application=\"$application\",instance=\"$instance\", area=\"heap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "",
            "refId": "A",
            "step": 14400
          }
        ],
        "title": "Heap used",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "decimals": 2,
            "mappings": [
              {
                "options": {
                  "match": "null",
                  "result": {
                    "text": "N/A"
                  }
                },
                "type": "special"
              },
              {
                "options": {
                  "from": -1e+32,
                  "result": {
                    "text": "N/A"
                  },
                  "to": 0
                },
                "type": "range"
              }
            ],
            "max": 100,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "rgba(50, 172, 45, 0.97)"
                },
                {
                  "color": "rgba(237, 129, 40, 0.89)",
                  "value": 70
                },
                {
                  "color": "rgba(245, 54, 54, 0.9)",
                  "value": 90
                }
              ]
            },
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 10
        },
        "id": 75,
        "maxDataPoints": 100,
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "justifyMode": "auto",
          "orientation": "horizontal",
          "percentChangeColorMode": "standard",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"})*100/sum(jvm_memory_max_bytes{application=\"$application\",instance=\"$instance\", area=\"nonheap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "",
            "refId": "A",
            "step": 14400
          }
        ],
        "title": "Non-Heap used",
        "type": "stat"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 13
        },
        "id": 140,
        "panels": [],
        "title": "I/O Overview",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "ops"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 0,
          "y": 14
        },
        "id": 111,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(rate(http_server_requests_seconds_count{application=\"$application\", instance=\"$instance\"}[1m]))",
            "format": "time_series",
            "intervalFactor": 1,
            "legendFormat": "HTTP",
            "refId": "A"
          }
        ],
        "title": "Rate",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "ops"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "HTTP"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#890f02",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "HTTP - 5xx"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#bf1b00",
                    "mode": "fixed"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 6,
          "y": 14
        },
        "id": 112,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(rate(http_server_requests_seconds_count{application=\"$application\", instance=\"$instance\", status=~\"5..\"}[1m]))",
            "format": "time_series",
            "intervalFactor": 1,
            "legendFormat": "HTTP - 5xx",
            "refId": "A"
          }
        ],
        "title": "Errors",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "s"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 12,
          "y": 14
        },
        "id": 113,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(rate(http_server_requests_seconds_sum{application=\"$application\", instance=\"$instance\", status!~\"5..\"}[1m]))/sum(rate(http_server_requests_seconds_count{application=\"$application\", instance=\"$instance\", status!~\"5..\"}[1m]))",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 1,
            "legendFormat": "HTTP - AVG",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "max(http_server_requests_seconds_max{application=\"$application\", instance=\"$instance\", status!~\"5..\"})",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 1,
            "legendFormat": "HTTP - MAX",
            "refId": "B"
          }
        ],
        "title": "Duration",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 18,
          "y": 14
        },
        "id": 119,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "tomcat_threads_busy_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "TOMCAT - BSY",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "tomcat_threads_current_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "TOMCAT - CUR",
            "refId": "B"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "tomcat_threads_config_max_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "TOMCAT - MAX",
            "refId": "C"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jetty_threads_busy{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "JETTY - BSY",
            "refId": "D"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jetty_threads_current{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "JETTY - CUR",
            "refId": "E"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jetty_threads_config_max{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "JETTY - MAX",
            "refId": "F"
          }
        ],
        "title": "Utilisation",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 21
        },
        "id": 141,
        "panels": [],
        "title": "JVM Memory",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 0,
          "y": 22
        },
        "id": 24,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "used",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_committed_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "committed",
            "refId": "B",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_max_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "max",
            "refId": "C",
            "step": 2400
          }
        ],
        "title": "JVM Heap",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 6,
          "y": 22
        },
        "id": 25,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"})",
            "format": "time_series",
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "used",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_committed_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "committed",
            "refId": "B",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_max_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "max",
            "refId": "C",
            "step": 2400
          }
        ],
        "title": "JVM Non-Heap",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 12,
          "y": 22
        },
        "id": 26,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "used",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_committed_bytes{application=\"$application\", instance=\"$instance\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "committed",
            "refId": "B",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(jvm_memory_max_bytes{application=\"$application\", instance=\"$instance\"})",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "max",
            "refId": "C",
            "step": 2400
          }
        ],
        "title": "JVM Total",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "bytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 18,
          "y": 22
        },
        "id": 86,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_memory_vss_bytes{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": true,
            "intervalFactor": 2,
            "legendFormat": "vss",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_memory_rss_bytes{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "rss",
            "refId": "B"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_memory_swap_bytes{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "swap",
            "refId": "C"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_memory_rss_bytes{application=\"$application\", instance=\"$instance\"} + process_memory_swap_bytes{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "total",
            "refId": "D"
          }
        ],
        "title": "JVM Process Memory",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 29
        },
        "id": 142,
        "panels": [],
        "title": "JVM Misc",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 1,
            "mappings": [],
            "max": 1,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percentunit"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 0,
          "y": 30
        },
        "id": 106,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "system_cpu_usage{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 1,
            "legendFormat": "system",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_cpu_usage{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 1,
            "legendFormat": "process",
            "refId": "B"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "avg_over_time(process_cpu_usage{application=\"$application\", instance=\"$instance\"}[15m])",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 1,
            "legendFormat": "process-15m",
            "refId": "C"
          }
        ],
        "title": "CPU Usage",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 1,
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 6,
          "y": 30
        },
        "id": 93,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "system_load_average_1m{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "system-1m",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "system_cpu_count{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "cpus",
            "refId": "B"
          }
        ],
        "title": "Load",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 0,
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 12,
          "y": 30
        },
        "id": 32,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_threads_live_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "live",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_threads_daemon_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "daemon",
            "metric": "",
            "refId": "B",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_threads_peak_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "peak",
            "refId": "C",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "process",
            "refId": "D",
            "step": 2400
          }
        ],
        "title": "Threads",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "blocked"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#bf1b00",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "new"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#fce2de",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "runnable"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#7eb26d",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "terminated"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#511749",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "timed-waiting"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#c15c17",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "waiting"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#eab839",
                    "mode": "fixed"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 18,
          "y": 30
        },
        "id": 124,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_threads_states_threads{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "{{state}}",
            "refId": "A"
          }
        ],
        "title": "Thread States",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "description": "The percent of time spent on Garbage Collection over all CPUs assigned to the JVM process.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 1,
            "mappings": [],
            "max": 1,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percentunit"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 0,
          "y": 37
        },
        "id": 138,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "sum(rate(jvm_gc_pause_seconds_sum{application=\"$application\", instance=\"$instance\"}[1m])) by (application, instance) / on(application, instance) system_cpu_count",
            "format": "time_series",
            "intervalFactor": 1,
            "legendFormat": "CPU time spent on GC",
            "refId": "A"
          }
        ],
        "title": "GC Pressure",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 0,
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "opm"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "debug"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#1F78C1",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "error"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#BF1B00",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "info"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#508642",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "trace"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#6ED0E0",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "warn"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#EAB839",
                    "mode": "fixed"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 7,
          "w": 12,
          "x": 6,
          "y": 37
        },
        "id": 91,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "increase(logback_events_total{application=\"$application\", instance=\"$instance\"}[1m])",
            "format": "time_series",
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "{{level}}",
            "metric": "",
            "refId": "A",
            "step": 1200
          }
        ],
        "title": "Log Events",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "log": 10,
                "type": "log"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 0,
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 18,
          "y": 37
        },
        "id": 61,
        "options": {
          "legend": {
            "calcs": [
              "lastNotNull",
              "max"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_files_open_files{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "open",
            "metric": "",
            "refId": "A",
            "step": 2400
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "process_files_max_files{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "max",
            "metric": "",
            "refId": "B",
            "step": 2400
          }
        ],
        "title": "File Descriptors",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 44
        },
        "id": 143,
        "panels": [],
        "repeat": "persistence_counts",
        "title": "JVM Memory Pools (Heap)",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 24,
          "x": 0,
          "y": 45
        },
        "id": 3,
        "maxPerRow": 3,
        "options": {},
        "repeat": "jvm_memory_pool_heap",
        "repeatDirection": "h",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_memory_pool_heap\"}",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "used",
            "metric": "",
            "refId": "A",
            "step": 1800
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_memory_committed_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_memory_pool_heap\"}",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "commited",
            "metric": "",
            "refId": "B",
            "step": 1800
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_memory_max_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_memory_pool_heap\"}",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "max",
            "metric": "",
            "refId": "C",
            "step": 1800
          }
        ],
        "title": "$jvm_memory_pool_heap",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 52
        },
        "id": 144,
        "panels": [],
        "title": "JVM Memory Pools (Non-Heap)",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 24,
          "x": 0,
          "y": 53
        },
        "id": 78,
        "maxPerRow": 3,
        "options": {},
        "repeat": "jvm_memory_pool_nonheap",
        "repeatDirection": "h",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_memory_pool_nonheap\"}",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "used",
            "metric": "",
            "refId": "A",
            "step": 1800
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_memory_committed_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_memory_pool_nonheap\"}",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "commited",
            "metric": "",
            "refId": "B",
            "step": 1800
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_memory_max_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_memory_pool_nonheap\"}",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 2,
            "legendFormat": "max",
            "metric": "",
            "refId": "C",
            "step": 1800
          }
        ],
        "title": "$jvm_memory_pool_nonheap",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 60
        },
        "id": 145,
        "panels": [],
        "title": "Garbage Collection",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 8,
          "x": 0,
          "y": 61
        },
        "id": 98,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "rate(jvm_gc_pause_seconds_count{application=\"$application\", instance=\"$instance\"}[1m])",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 1,
            "legendFormat": "{{action}} ({{cause}})",
            "refId": "A"
          }
        ],
        "title": "Collections",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 8,
          "x": 8,
          "y": 61
        },
        "id": 101,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "rate(jvm_gc_pause_seconds_sum{application=\"$application\", instance=\"$instance\"}[1m])/rate(jvm_gc_pause_seconds_count{application=\"$application\", instance=\"$instance\"}[1m])",
            "format": "time_series",
            "hide": false,
            "instant": false,
            "intervalFactor": 1,
            "legendFormat": "avg {{action}} ({{cause}})",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_gc_pause_seconds_max{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "hide": false,
            "instant": false,
            "intervalFactor": 1,
            "legendFormat": "max {{action}} ({{cause}})",
            "refId": "B"
          }
        ],
        "title": "Pause Durations",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 8,
          "x": 16,
          "y": 61
        },
        "id": 99,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "rate(jvm_gc_memory_allocated_bytes_total{application=\"$application\", instance=\"$instance\"}[1m])",
            "format": "time_series",
            "interval": "",
            "intervalFactor": 1,
            "legendFormat": "allocated",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "rate(jvm_gc_memory_promoted_bytes_total{application=\"$application\", instance=\"$instance\"}[1m])",
            "format": "time_series",
            "interval": "",
            "intervalFactor": 1,
            "legendFormat": "promoted",
            "refId": "B"
          }
        ],
        "title": "Allocated/Promoted",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 68
        },
        "id": 146,
        "panels": [],
        "title": "Classloading",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 12,
          "x": 0,
          "y": 69
        },
        "id": 37,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_classes_loaded_classes{application=\"$application\", instance=\"$instance\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "loaded",
            "metric": "",
            "refId": "A",
            "step": 1200
          }
        ],
        "title": "Classes loaded",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.6,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 12,
          "x": 12,
          "y": 69
        },
        "id": 38,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "11.6.1",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "delta(jvm_classes_loaded_classes{application=\"$application\",instance=\"$instance\"}[1m])",
            "format": "time_series",
            "hide": false,
            "interval": "",
            "intervalFactor": 1,
            "legendFormat": "delta-1m",
            "metric": "",
            "refId": "A",
            "step": 1200
          }
        ],
        "title": "Class delta",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 76
        },
        "id": 147,
        "panels": [],
        "title": "Buffer Pools",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 24,
          "x": 0,
          "y": 77
        },
        "id": 131,
        "maxPerRow": 3,
        "options": {},
        "repeat": "jvm_buffer_pool",
        "repeatDirection": "h",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_buffer_memory_used_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_buffer_pool\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "used",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_buffer_total_capacity_bytes{application=\"$application\", instance=\"$instance\", id=~\"$jvm_buffer_pool\"}",
            "format": "time_series",
            "intervalFactor": 2,
            "legendFormat": "capacity",
            "refId": "B"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "DS_PROMETHEUS"
            },
            "expr": "jvm_buffer_count_buffers{application=\"$application\", instance=\"$instance\", id=~\"$jvm_buffer_pool\"}",
            "format": "time_series",
            "hide": false,
            "intervalFactor": 2,
            "legendFormat": "buffers",
            "refId": "C"
          }
        ],
        "title": "$jvm_buffer_pool",
        "type": "timeseries"
      }
    ],
    "preload": false,
    "refresh": "30s",
    "schemaVersion": 41,
    "tags": [],
    "templating": {
      "list": [
        {
          "current": {
            "text": "api-tutorial",
            "value": "api-tutorial"
          },
          "datasource": "Prometheus",
          "includeAll": false,
          "label": "Application",
          "name": "application",
          "options": [],
          "query": "label_values(application)",
          "refresh": 2,
          "regex": "",
          "type": "query"
        },
        {
          "current": {
            "text": "host.docker.internal:30506",
            "value": "host.docker.internal:30506"
          },
          "datasource": "Prometheus",
          "includeAll": false,
          "label": "Instance",
          "name": "instance",
          "options": [],
          "query": "label_values(jvm_memory_used_bytes{application=\"$application\"}, instance)",
          "refresh": 2,
          "regex": "",
          "type": "query"
        },
        {
          "current": {
            "text": "All",
            "value": "$__all"
          },
          "datasource": "Prometheus",
          "hide": 2,
          "includeAll": true,
          "label": "JVM Memory Pools Heap",
          "name": "jvm_memory_pool_heap",
          "options": [],
          "query": "label_values(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"},id)",
          "refresh": 1,
          "regex": "",
          "sort": 1,
          "type": "query"
        },
        {
          "current": {
            "text": "All",
            "value": "$__all"
          },
          "datasource": "Prometheus",
          "hide": 2,
          "includeAll": true,
          "label": "JVM Memory Pools Non-Heap",
          "name": "jvm_memory_pool_nonheap",
          "options": [],
          "query": "label_values(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"nonheap\"},id)",
          "refresh": 1,
          "regex": "",
          "sort": 2,
          "type": "query"
        },
        {
          "current": {
            "text": "All",
            "value": "$__all"
          },
          "datasource": "Prometheus",
          "hide": 2,
          "includeAll": true,
          "label": "JVM Buffer Pools",
          "name": "jvm_buffer_pool",
          "options": [],
          "query": "label_values(jvm_buffer_memory_used_bytes{application=\"$application\", instance=\"$instance\"},id)",
          "refresh": 1,
          "regex": "",
          "sort": 1,
          "type": "query"
        }
      ]
    },
    "time": {
      "from": "now-15m",
      "to": "now"
    },
    "timepicker": {},
    "timezone": "browser",
    "title": "API-Service-Uptime",
    "uid": "cekr8qp7an8cge",
    "version": 1
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
  namespace: observability
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
  template:
    metadata:
      labels:
        app: grafana
    spec:
      containers:
        - name: grafana
          image: grafana/grafana
          ports:
            - containerPort: 3000
          env:
            - name: GF_SECURITY_ADMIN_USER
              value: "admin"
            - name: GF_SECURITY_ADMIN_PASSWORD
              value: "admin"
          volumeMounts:
            - name: datasources
              mountPath: /etc/grafana/provisioning/datasources
            - name: dashboards
              mountPath: /etc/grafana/provisioning/dashboards
            - name: dashboard-json
              mountPath: /var/lib/grafana/dashboards
      volumes:
        - name: datasources
          configMap:
            name: grafana-datasources
        - name: dashboards
          configMap:
            name: grafana-dashboards
        - name: dashboard-json
          configMap:
            name: grafana-dashboard-json
---
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: observability
spec:
  type: NodePort
  selector:
    app: grafana
  ports:
    - port: 3000
      targetPort: 3000
      protocol: TCP
      nodePort: 32000